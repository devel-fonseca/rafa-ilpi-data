Agora preciso imaginar um cadastro de prescrições para os residentes. “Medicação” é a melhor opção se quiser simplicidade e aderência operacional.

Segue wireframe do dashboard de Medicação:

Medicação                                [ + NOVA PRESCRIÇÃO ]
Gerencie as prescrições dos residentes da ILPI.

[ CARDS SUPERIORES ]
──────────────────────────────────────────────────────────────
| Prescrições Ativas: 27  |  Vencem em até 5 dias: 4         |
| Antibióticos ativos: 2  |  Controlados ativos: 6           |
──────────────────────────────────────────────────────────────

[ ALERTAS CRÍTICOS ]
──────────────────────────────────────────────────────────────
⚠ Residentes com prescrição vencida (3)
⚠ Medicamentos controlados sem receita anexada (1)
⚠ Prescrições com conflito de horário (2)
⚠ Antibióticos sem validade registrada (1)
──────────────────────────────────────────────────────────────

[ AÇÕES DO DIA – TURNO ATUAL: MANHÃ ]
──────────────────────────────────────────────────────────────
06:00 – Doses pendentes: 5
06:00 – Doses atrasadas: 1
06:00 – Controlados a administrar: 2
──────────────────────────────────────────────────────────────

[ LISTA RÁPIDA DE PRESCRIÇÕES PRÓXIMAS DO VENCIMENTO ]
──────────────────────────────────────────────────────────────
• João da Silva – vence em 2 dias – Antibiótico
• Maria Ferreira – vence em 3 dias – Controlado
• Carlos Eduardo – vence em 4 dias – Rotina
──────────────────────────────────────────────────────────────

[ RESIDENTES COM CONTROLADOS ]
──────────────────────────────────────────────────────────────
• João da Silva – Clonazepam 2 mg – 22:00
• Marta Almeida – Quetiapina 25 mg – 20:00
• Pedro Ramos – Diazepam 10 mg – 23:00
──────────────────────────────────────────────────────────────

---
No cadastro de nova prescrição que será mostrado mais adiante, é preciso fazer algumas modificações, já que os dados do residente (stepper 1) que serão exibidos devem ser os dados que foram registrados no cadastro do residente, esses campos não serão editáveis.

Alergias vamos retirar o badge de obrigatório pois os dados que serão mostrados devem ser do que foi cadastrado no cadastro do residente. E ao invés de mostrar Diagnósticos relevantes e Observações clínicas que não são campos desejáveis no cadastro de residentes e por isso não constam, mostraremos apenas o campo Condições Crônicas.
Onde mostra Leito/Quarto, deve ser mostrado Quarto e Leito

Em ambiente de ILPI, não é adequado exigir validade da prescrição para todo medicamento contínuo. Isso só faz sentido para alguns grupos específicos.

Vou deixar claro, direto e pragmático — como se o senhor estivesse alinhando isso com o enfermeiro responsável.
1) Medicamento contínuo comum — NÃO exige validade

O ciclo normal de medicação de rotina (antihipertensivos, anticonvulsivantes, antidepressivos, ansiolíticos, suplementos, etc.) não exige validade da prescrição.

Por quê?

    Prescrições de rotina, para uso contínuo, permanecem válidas até que sejam substituídas.

    O médico muda apenas quando necessário.

    Exigir validade gera burocracia inútil e risco de recusar administração sem necessidade.

Ou seja:
➡ Medicamento contínuo padrão → não pede validade.

2) Quando a validade é obrigatória

A validade precisa ser exigida automaticamente apenas em três grupos:
a) Medicamentos controlados / psicotrópicos

Obrigatório registrar:

    validade

    tipo da notificação

    CRM

    número da receita especial

    anexar imagem da receita

b) Antibióticos (ABT)

RDC 20/2011 exige retenção e prazo da receita.
Validade deve ser registrada.
c) Medicações de alto risco ou com janela terapêutica estreita

Exemplos: anticoagulantes, insulinas específicas, antiepilépticos que exigem ajustes.
A validade pode ser pedida como campo opcional ou automática quando o enfermeiro marcar “alto risco”.
3) Como deve ficar o sistema (objetivo e prático)
Medicamentos contínuos (comuns)

[✓] Não exigir validade
[ ] Campo opcional de validade (oculto por padrão)

Antibiótico

[✓] Exigir validade obrigatória

Controlado / psicotrópico

[✓] Exigir validade
[✓] Exigir receita anexada
[✓] Exigir número da notificação
[✓] Exigir tipo de notificação

Medicamento marcado como "Alto Risco"

[✓] Mostrar campo de validade (opcional)
[✓] Permitir indicar prazo de revisão

Conclusão prática para a ILPI

➡ Contínuo comum: não exige validade.
➡ Antibiótico ou controlado: exige validade.
➡ Alto risco: sugerir validade, mas como opcional.

---
Prototipagem sem as alterações requisitadas acima:

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Stepper - Prescrição ILPI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: 16px;
      color: #222;
      background-color: #f5f5f7;
    }
    body {
      margin: 0;
      padding: 1.5rem;
      display: flex;
      justify-content: center;
    }
    .container {
      max-width: 900px;
      width: 100%;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06);
      padding: 1.5rem 2rem 2rem;
      box-sizing: border-box;
    }
    h1 {
      font-size: 1.4rem;
      margin: 0 0 0.5rem;
    }
    h2 {
      font-size: 1.2rem;
      margin-top: 0;
    }
    .subtitle {
      color: #666;
      margin-bottom: 1rem;
    }

    /* Stepper header */
    .stepper {
      display: flex;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .stepper-step {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      min-width: 140px;
    }
    .stepper-circle {
      width: 26px;
      height: 26px;
      border-radius: 50%;
      border: 2px solid #ccccd6;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      background: #f5f5f7;
      color: #666;
    }
    .stepper-label {
      font-size: 0.82rem;
      color: #777;
      white-space: nowrap;
    }
    .stepper-step.active .stepper-circle {
      border-color: #2563eb;
      background: #2563eb;
      color: #fff;
    }
    .stepper-step.active .stepper-label {
      color: #2563eb;
      font-weight: 600;
    }
    .stepper-step.completed .stepper-circle {
      border-color: #16a34a;
      background: #16a34a;
      color: #fff;
    }
    .stepper-step.completed .stepper-label {
      color: #16a34a;
      font-weight: 500;
    }

    /* Card / steps */
    .step {
      display: none;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      padding: 1rem 1.25rem;
      background: #fafafa;
    }
    .step.active {
      display: block;
    }

    .row {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 0.75rem;
    }
    .field {
      flex: 1;
      min-width: 180px;
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }
    label {
      font-size: 0.82rem;
      color: #444;
    }
    input[type="text"],
    input[type="date"],
    input[type="time"],
    input[type="number"],
    select,
    textarea {
      border-radius: 6px;
      border: 1px solid #d1d5db;
      padding: 0.35rem 0.5rem;
      font-size: 0.9rem;
      box-sizing: border-box;
      background: #fff;
    }
    textarea {
      min-height: 60px;
      resize: vertical;
    }
    input[type="file"] {
      font-size: 0.85rem;
    }
    .hint {
      font-size: 0.75rem;
      color: #888;
    }

    .checkbox-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin: 0.5rem 0;
      font-size: 0.85rem;
    }
    .checkbox-row label {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.82rem;
      margin-top: 0.5rem;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 0.4rem 0.5rem;
      text-align: left;
    }
    th {
      background: #f3f4f6;
      font-weight: 600;
    }

    .tag-pill {
      display: inline-block;
      padding: 0.1rem 0.45rem;
      font-size: 0.7rem;
      border-radius: 999px;
      background: #e5f0ff;
      color: #2563eb;
      margin-left: 0.25rem;
    }

    /* Buttons */
    .actions {
      display: flex;
      justify-content: space-between;
      margin-top: 1rem;
      gap: 0.75rem;
      flex-wrap: wrap;
    }
    .btn {
      border-radius: 999px;
      border: 1px solid transparent;
      padding: 0.4rem 1.1rem;
      font-size: 0.88rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      white-space: nowrap;
    }
    .btn-primary {
      background: #2563eb;
      color: #fff;
    }
    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
    }
    .btn-ghost {
      background: transparent;
      color: #2563eb;
      border-color: #bfdbfe;
    }
    .btn-sm {
      font-size: 0.8rem;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
    }
    .btn-danger {
      background: #dc2626;
      color: #fff;
    }

    .badge-warning {
      font-size: 0.75rem;
      color: #92400e;
      background: #fef3c7;
      padding: 0.15rem 0.4rem;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }

    .summary-box {
      border-radius: 8px;
      border: 1px dashed #d1d5db;
      padding: 0.75rem 0.9rem;
      background: #f9fafb;
      font-size: 0.85rem;
    }
    .summary-box strong {
      display: inline-block;
      min-width: 120px;
    }

    .error {
      color: #b91c1c;
      font-size: 0.8rem;
      margin-top: 0.2rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Prescrição de Medicamentos – ILPI</h1>
    <div class="subtitle">Stepper para cadastro guiado de prescrição vinculada ao residente.</div>

    <!-- STEPPER HEADER -->
    <div class="stepper" id="stepperHeader">
      <div class="stepper-step active" data-step="0">
        <div class="stepper-circle">1</div>
        <div class="stepper-label">Residente</div>
      </div>
      <div class="stepper-step" data-step="1">
        <div class="stepper-circle">2</div>
        <div class="stepper-label">Prescritor</div>
      </div>
      <div class="stepper-step" data-step="2">
        <div class="stepper-circle">3</div>
        <div class="stepper-label">Medicamentos</div>
      </div>
      <div class="stepper-step" data-step="3">
        <div class="stepper-circle">4</div>
        <div class="stepper-label">SOS</div>
      </div>
      <div class="stepper-step" data-step="4">
        <div class="stepper-circle">5</div>
        <div class="stepper-label">Anexos &amp; Revisão</div>
      </div>
    </div>

    <!-- STEP 1 – RESIDENTE -->
    <div class="step active" data-step="0">
      <h2>1. Dados do Residente</h2>
      <div class="row">
        <div class="field">
          <label>Nome completo</label>
          <input type="text" id="res_nome" value="João da Silva" />
        </div>
        <div class="field">
          <label>Data de nascimento</label>
          <input type="date" id="res_nasc" />
        </div>
        <div class="field">
          <label>Leito / Quarto</label>
          <input type="text" id="res_leito" placeholder="Ex.: 12B" />
        </div>
      </div>
      <div class="row">
        <div class="field">
          <label>Alergias <span class="tag-pill">Obrigatório</span></label>
          <input type="text" id="res_alergias" placeholder="Ex.: Dipirona, Amoxicilina" />
          <div class="hint">Se não houver, registrar “Sem alergias conhecidas”.</div>
          <div class="error" id="err_step1"></div>
        </div>
      </div>
      <div class="row">
        <div class="field">
          <label>Diagnósticos relevantes</label>
          <textarea id="res_diag" placeholder="HAS, DM2, cardiopatia, demência leve..."></textarea>
        </div>
        <div class="field">
          <label>Observações clínicas</label>
          <textarea id="res_obs" placeholder="Disfagia, restrição hídrica, risco de queda..."></textarea>
        </div>
      </div>
      <div class="actions">
        <span></span>
        <button class="btn btn-primary" id="next0">Avançar para Prescritor ➜</button>
      </div>
    </div>

    <!-- STEP 2 – PRESCRITOR -->
    <div class="step" data-step="1">
      <h2>2. Médico Prescritor</h2>
      <div class="row">
        <div class="field">
          <label>Nome do médico</label>
          <input type="text" id="med_nome" placeholder="Dr(a). Nome do médico" />
        </div>
        <div class="field">
          <label>CRM</label>
          <input type="text" id="med_crm" placeholder="123456" />
        </div>
        <div class="field">
          <label>UF</label>
          <select id="med_uf">
            <option value="SP">SP</option>
            <option value="RJ">RJ</option>
            <option value="MG">MG</option>
            <option value="PR">PR</option>
          </select>
        </div>
      </div>
      <div class="row">
        <div class="field">
          <label>Data da prescrição</label>
          <input type="date" id="med_data" />
        </div>
        <div class="field">
          <label>Tipo de prescrição</label>
          <select id="med_tipo">
            <option value="rotina">Rotina</option>
            <option value="alteracao">Alteração pontual</option>
            <option value="antibiotico">Antibiótico</option>
            <option value="alto_risco">Alto risco</option>
            <option value="controlado">Controlado / Psicofármaco</option>
            <option value="outro">Outra</option>
          </select>
        </div>
        <div class="field">
          <label>Validade da prescrição</label>
          <input type="date" id="med_validade" />
        </div>
      </div>

      <!-- Campos extras se controlado -->
      <div id="controladoExtra" style="display:none; margin-top:0.75rem;">
        <div class="badge-warning">⚠ Prescrição de medicamento controlado – controle especial obrigatório</div>
        <div class="row" style="margin-top:0.5rem;">
          <div class="field">
            <label>Classe do medicamento</label>
            <select id="ctrl_classe">
              <option value="bzd">BZD / Benzodiazepínico</option>
              <option value="psicofarmaco">Psicofármaco</option>
              <option value="opioide">Opioide</option>
              <option value="anticonvulsivante">Anticonvulsivante</option>
              <option value="outro">Outro</option>
            </select>
          </div>
          <div class="field">
            <label>Nº Notificação de Receita</label>
            <input type="text" id="ctrl_notif" />
          </div>
          <div class="field">
            <label>Tipo de Notificação</label>
            <select id="ctrl_tipo">
              <option value="amarela">Amarela</option>
              <option value="azul">Azul</option>
              <option value="branca">Branca especial</option>
              <option value="na">Não se aplica</option>
            </select>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>Observações sobre o prescritor / prescrição</label>
          <textarea id="med_obs"></textarea>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-secondary" id="back1">◀ Voltar</button>
        <button class="btn btn-primary" id="next1">Avançar para Medicamentos ➜</button>
      </div>
    </div>

    <!-- STEP 3 – MEDICAMENTOS -->
    <div class="step" data-step="2">
      <h2>3. Medicamentos Contínuos</h2>
      <button class="btn btn-ghost btn-sm" id="addMed">+ Adicionar Medicamento</button>
      <div class="hint">Cadastre cada item da prescrição. Pelo menos 1 medicamento é obrigatório.</div>
      <div class="error" id="err_step3"></div>

      <table id="medTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Medicamento</th>
            <th>Dose</th>
            <th>Horários</th>
            <th>Via</th>
            <th>Controlado</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <!-- linhas inseridas via JS -->
        </tbody>
      </table>

      <!-- Modalzinho simples inline -->
      <div id="medForm" style="margin-top:1rem; display:none; border-top:1px solid #e5e7eb; padding-top:0.75rem;">
        <h3 style="font-size:1rem; margin:0 0 0.5rem;">Novo medicamento</h3>
        <div class="row">
          <div class="field">
            <label>Medicamento (DCB)</label>
            <input type="text" id="mf_nome" />
          </div>
          <div class="field">
            <label>Apresentação</label>
            <select id="mf_apres">
              <option>Comprimido</option>
              <option>Cápsula</option>
              <option>Ampola</option>
              <option>Gotas</option>
              <option>Solução</option>
              <option>Pomada</option>
              <option>Outro</option>
            </select>
          </div>
          <div class="field">
            <label>Concentração</label>
            <input type="text" id="mf_conc" placeholder="Ex.: 500mg, 5mg/mL" />
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>Dose prescrita</label>
            <input type="text" id="mf_dose" placeholder="1 cp, 20 gotas, 5 mL..." />
          </div>
          <div class="field">
            <label>Via</label>
            <select id="mf_via">
              <option>VO</option>
              <option>IM</option>
              <option>EV</option>
              <option>SC</option>
              <option>Tópica</option>
              <option>Outra</option>
            </select>
          </div>
          <div class="field">
            <label>Frequência</label>
            <select id="mf_freq">
              <option>1x/dia</option>
              <option>2x/dia</option>
              <option>8/8h</option>
              <option>12/12h</option>
              <option>6/6h</option>
              <option>Personalizado</option>
            </select>
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>Horários (texto livre para protótipo)</label>
            <input type="text" id="mf_horarios" placeholder="06:00, 14:00, 22:00" />
          </div>
          <div class="field">
            <label>Início</label>
            <input type="date" id="mf_ini" />
          </div>
          <div class="field">
            <label>Término</label>
            <input type="date" id="mf_fim" />
          </div>
        </div>
        <div class="checkbox-row">
          <label><input type="checkbox" id="mf_ctrl" /> Medicamento controlado</label>
          <label><input type="checkbox" id="mf_alto_risco" /> Alto risco</label>
          <label><input type="checkbox" id="mf_dupla" /> Exige dupla checagem</label>
        </div>
        <div class="row">
          <div class="field">
            <label>Observações</label>
            <textarea id="mf_obs"></textarea>
          </div>
        </div>
        <div class="actions" style="justify-content:flex-end;">
          <button class="btn btn-secondary btn-sm" id="mf_cancel">Cancelar</button>
          <button class="btn btn-primary btn-sm" id="mf_salvar">Salvar medicamento</button>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-secondary" id="back2">◀ Voltar</button>
        <button class="btn btn-primary" id="next2">Avançar para SOS ➜</button>
      </div>
    </div>

    <!-- STEP 4 – SOS -->
    <div class="step" data-step="3">
      <h2>4. Medicações SOS (uso eventual)</h2>
      <button class="btn btn-ghost btn-sm" id="addSOS">+ Adicionar SOS</button>
      <div class="hint">Opcional. Use para dor, febre, ansiedade etc. com gatilhos claros.</div>

      <table id="sosTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Medicamento</th>
            <th>Indicação</th>
            <th>Dose</th>
            <th>Intervalo mín.</th>
            <th>Limite diário</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div id="sosForm" style="margin-top:1rem; display:none; border-top:1px solid #e5e7eb; padding-top:0.75rem;">
        <h3 style="font-size:1rem; margin:0 0 0.5rem;">Nova medicação SOS</h3>
        <div class="row">
          <div class="field">
            <label>Medicamento</label>
            <input type="text" id="sf_nome" />
          </div>
          <div class="field">
            <label>Indicação (gatilho)</label>
            <input type="text" id="sf_indic" placeholder="Ex.: dor &gt; 7, febre &gt; 38º" />
          </div>
          <div class="field">
            <label>Dose</label>
            <input type="text" id="sf_dose" />
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>Intervalo mínimo</label>
            <input type="text" id="sf_intervalo" placeholder="Ex.: a cada 6h" />
          </div>
          <div class="field">
            <label>Limite diário</label>
            <input type="text" id="sf_limite" placeholder="Ex.: máx. 3 doses/dia" />
          </div>
        </div>
        <div class="row">
          <div class="field">
            <label>Observações</label>
            <textarea id="sf_obs"></textarea>
          </div>
        </div>
        <div class="actions" style="justify-content:flex-end;">
          <button class="btn btn-secondary btn-sm" id="sf_cancel">Cancelar</button>
          <button class="btn btn-primary btn-sm" id="sf_salvar">Salvar SOS</button>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-secondary" id="back3">◀ Voltar</button>
        <button class="btn btn-primary" id="next3">Avançar para Anexos &amp; Revisão ➜</button>
      </div>
    </div>

    <!-- STEP 5 – ANEXOS & REVISÃO -->
    <div class="step" data-step="4">
      <h2>5. Anexos &amp; Revisão Final</h2>
      <div class="row">
        <div class="field">
          <label>Upload da receita médica (imagem/PDF)</label>
          <input type="file" id="file_receita" accept=".pdf,image/*" />
          <div class="hint">Obrigatório se houver medicamento controlado.</div>
        </div>
      </div>

      <div class="summary-box" id="summaryBox">
        <!-- preenchido via JS -->
      </div>

      <div class="error" id="err_step5"></div>

      <div class="actions">
        <button class="btn btn-secondary" id="back4">◀ Voltar</button>
        <button class="btn btn-primary" id="finish">Concluir Prescrição ✔</button>
      </div>
    </div>
  </div>

  <script>
    // Controle básico de steps
    const steps = document.querySelectorAll(".step");
    const stepperSteps = document.querySelectorAll(".stepper-step");
    let currentStep = 0;

    function updateStepperHeader() {
      stepperSteps.forEach((el, idx) => {
        el.classList.remove("active", "completed");
        if (idx < currentStep) el.classList.add("completed");
        if (idx === currentStep) el.classList.add("active");
      });
    }

    function showStep(index) {
      steps.forEach(s => s.classList.remove("active"));
      const step = document.querySelector('.step[data-step="' + index + '"]');
      if (step) {
        step.classList.add("active");
        currentStep = index;
        updateStepperHeader();
      }
    }

    // Step 1 – valida alergias
    document.getElementById("next0").addEventListener("click", () => {
      const alergias = document.getElementById("res_alergias").value.trim();
      const err = document.getElementById("err_step1");
      if (!alergias) {
        err.textContent = "Preencha o campo de alergias (ou registre 'Sem alergias conhecidas').";
        return;
      }
      err.textContent = "";
      showStep(1);
    });

    // Step 2 – extra de controlado
    const tipoSelect = document.getElementById("med_tipo");
    const controladoExtra = document.getElementById("controladoExtra");

    tipoSelect.addEventListener("change", () => {
      if (tipoSelect.value === "controlado") {
        controladoExtra.style.display = "block";
      } else {
        controladoExtra.style.display = "none";
      }
    });

    document.getElementById("back1").addEventListener("click", () => showStep(0));
    document.getElementById("next1").addEventListener("click", () => showStep(2));

    // Step 3 – medicamentos
    const medTableBody = document.querySelector("#medTable tbody");
    const addMedBtn = document.getElementById("addMed");
    const medForm = document.getElementById("medForm");
    const errStep3 = document.getElementById("err_step3");
    let meds = [];
    let sosList = [];

    function renderMeds() {
      medTableBody.innerHTML = "";
      meds.forEach((m, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${idx + 1}</td>
          <td>${m.nome}</td>
          <td>${m.dose}</td>
          <td>${m.horarios}</td>
          <td>${m.via}</td>
          <td>${m.controlado ? "Sim" : "Não"}</td>
          <td><button class="btn btn-sm btn-danger" data-del-med="${idx}">Remover</button></td>
        `;
        medTableBody.appendChild(tr);
      });
    }

    medTableBody.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-del-med]");
      if (btn) {
        const idx = parseInt(btn.getAttribute("data-del-med"), 10);
        meds.splice(idx, 1);
        renderMeds();
      }
    });

    addMedBtn.addEventListener("click", () => {
      medForm.style.display = "block";
    });

    document.getElementById("mf_cancel").addEventListener("click", () => {
      medForm.style.display = "none";
    });

    document.getElementById("mf_salvar").addEventListener("click", () => {
      const nome = document.getElementById("mf_nome").value.trim();
      const dose = document.getElementById("mf_dose").value.trim();
      const horarios = document.getElementById("mf_horarios").value.trim();
      const via = document.getElementById("mf_via").value;
      const controlado = document.getElementById("mf_ctrl").checked;

      if (!nome || !dose || !horarios) {
        alert("Preencha pelo menos Nome, Dose e Horários.");
        return;
      }

      meds.push({ nome, dose, horarios, via, controlado });
      renderMeds();
      medForm.style.display = "none";

      // limpa campos básicos (para protótipo, não todos)
      document.getElementById("mf_nome").value = "";
      document.getElementById("mf_dose").value = "";
      document.getElementById("mf_horarios").value = "";
      document.getElementById("mf_ctrl").checked = false;
    });

    document.getElementById("back2").addEventListener("click", () => showStep(1));
    document.getElementById("next2").addEventListener("click", () => {
      if (meds.length === 0) {
        errStep3.textContent = "Cadastre pelo menos 1 medicamento contínuo.";
        return;
      }
      errStep3.textContent = "";
      showStep(3);
    });

    // Step 4 – SOS
    const sosTableBody = document.querySelector("#sosTable tbody");
    const sosForm = document.getElementById("sosForm");

    function renderSOS() {
      sosTableBody.innerHTML = "";
      sosList.forEach((s, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${idx + 1}</td>
          <td>${s.nome}</td>
          <td>${s.indic}</td>
          <td>${s.dose}</td>
          <td>${s.intervalo}</td>
          <td>${s.limite}</td>
          <td><button class="btn btn-sm btn-danger" data-del-sos="${idx}">Remover</button></td>
        `;
        sosTableBody.appendChild(tr);
      });
    }

    sosTableBody.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-del-sos]");
      if (btn) {
        const idx = parseInt(btn.getAttribute("data-del-sos"), 10);
        sosList.splice(idx, 1);
        renderSOS();
      }
    });

    document.getElementById("addSOS").addEventListener("click", () => {
      sosForm.style.display = "block";
    });

    document.getElementById("sf_cancel").addEventListener("click", () => {
      sosForm.style.display = "none";
    });

    document.getElementById("sf_salvar").addEventListener("click", () => {
      const nome = document.getElementById("sf_nome").value.trim();
      const indic = document.getElementById("sf_indic").value.trim();
      const dose = document.getElementById("sf_dose").value.trim();
      const intervalo = document.getElementById("sf_intervalo").value.trim();
      const limite = document.getElementById("sf_limite").value.trim();

      if (!nome || !indic || !dose) {
        alert("Preencha pelo menos Medicamento, Indicação e Dose.");
        return;
      }

      sosList.push({ nome, indic, dose, intervalo, limite });
      renderSOS();
      sosForm.style.display = "none";

      document.getElementById("sf_nome").value = "";
      document.getElementById("sf_indic").value = "";
      document.getElementById("sf_dose").value = "";
      document.getElementById("sf_intervalo").value = "";
      document.getElementById("sf_limite").value = "";
    });

    document.getElementById("back3").addEventListener("click", () => showStep(2));
    document.getElementById("next3").addEventListener("click", () => {
      atualizarResumo();
      showStep(4);
    });

    // Step 5 – resumo e validação de controlado x receita
    function atualizarResumo() {
      const nome = document.getElementById("res_nome").value || "—";
      const leito = document.getElementById("res_leito").value || "—";
      const medNome = document.getElementById("med_nome").value || "Não informado";
      const medCrm = document.getElementById("med_crm").value || "—";
      const medUf = document.getElementById("med_uf").value || "—";
      const medData = document.getElementById("med_data").value || "—";
      const tipo = document.getElementById("med_tipo").value;

      const hasControlado = meds.some(m => m.controlado);
      const summary = document.getElementById("summaryBox");
      summary.innerHTML = `
        <div><strong>Residente:</strong> ${nome} – Leito/Quarto: ${leito}</div>
        <div><strong>Médico:</strong> ${medNome} – CRM ${medCrm}/${medUf}</div>
        <div><strong>Data da prescrição:</strong> ${medData}</div>
        <div><strong>Tipo de prescrição:</strong> ${tipo}</div>
        <div><strong>Medicamentos contínuos:</strong> ${meds.length}</div>
        <div><strong>Medicações SOS:</strong> ${sosList.length}</div>
        <div><strong>Contém controlado?</strong> ${hasControlado ? "Sim" : "Não"}</div>
      `;
    }

    document.getElementById("back4").addEventListener("click", () => showStep(3));

    document.getElementById("finish").addEventListener("click", () => {
      const err5 = document.getElementById("err_step5");
      err5.textContent = "";

      const hasControlado = meds.some(m => m.controlado);
      const file = document.getElementById("file_receita").files[0];

      if (hasControlado && !file) {
        err5.textContent = "Prescrição contém medicamento controlado. Anexe a receita médica.";
        return;
      }

      alert("Prescrição concluída (protótipo). Aqui entraria a chamada à API / backend.");
    });

    // Inicialização
    updateStepperHeader();
  </script>
</body>
</html>

---


As idéias são essas mas o visual final deve ser refinado para ser consistente o dashboard cadastro de Residentes.
